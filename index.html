<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced MS Excel MCQ Exam System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-color: #48bb78;
            --error-color: #e53e3e;
            --warning-color: #d69e2e;
            --info-color: #4299e1;
            --dark-bg: #1a202c;
            --dark-card: #2d3748;
            --dark-text: #e2e8f0;
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: var(--primary-gradient); 
            min-height: 100vh; 
            padding: 20px; 
            transition: all 0.3s ease;
        }
        
        body.dark-mode {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            color: var(--dark-text);
        }
        
        .container { 
            background: white; 
            border-radius: 20px; 
            box-shadow: 0 25px 50px rgba(0,0,0,0.15); 
            padding: 2rem; 
            max-width: 1000px; 
            margin: 0 auto; 
            min-height: 75vh;
            transition: all 0.3s ease;
        }
        
        body.dark-mode .container {
            background: var(--dark-card);
            color: var(--dark-text);
        }
        
        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50px;
            padding: 12px 20px;
            cursor: pointer;
            font-size: 16px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            color: white;
            font-weight: 600;
        }
        
        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        /* Admin Toggle */
        .admin-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: linear-gradient(135deg, #9f7aea 0%, #805ad5 100%);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 15px 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 10px 25px rgba(159, 122, 234, 0.3);
        }
        
        .admin-toggle:hover {
            transform: scale(1.05);
        }
        
        /* Floating Animations */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        
        .floating-shape {
            position: absolute;
            opacity: 0.1;
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        /* Home Section */
        .home-section { text-align: center; }
        
        .institute-logo { 
            font-size: 5rem; 
            margin-bottom: 1rem; 
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .institute-name { 
            font-size: 2rem; 
            font-weight: bold; 
            color: #2c5282; 
            margin-bottom: 0.5rem; 
            text-transform: uppercase; 
            letter-spacing: 2px;
        }
        
        body.dark-mode .institute-name { color: var(--dark-text); }
        
        .institute-location { 
            font-size: 1.2rem; 
            color: var(--error-color); 
            font-weight: 600;
            margin-bottom: 3rem;
        }
        
        /* Access Card */
        .access-card { 
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            border: 2px solid #e2e8f0; 
            border-radius: 25px; 
            padding: 3rem 2rem; 
            margin: 2rem auto; 
            max-width: 550px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }
        
        body.dark-mode .access-card {
            background: linear-gradient(145deg, #2d3748, #1a202c);
            border-color: #4a5568;
        }
        
        .graduation-icon { 
            font-size: 4rem; 
            margin-bottom: 1rem;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .access-title { 
            color: #2d3748; 
            font-size: 1.6rem; 
            font-weight: bold; 
            margin-bottom: 1rem;
        }
        
        body.dark-mode .access-title { color: var(--dark-text); }
        
        .access-description { 
            color: #4a5568; 
            font-size: 1.1rem; 
            margin-bottom: 2rem; 
            line-height: 1.6;
        }
        
        body.dark-mode .access-description { color: #a0aec0; }
        
        /* Input Styling */
        .student-code-input { 
            width: 100%; 
            padding: 18px 25px; 
            border: 2px solid #cbd5e0; 
            border-radius: 15px; 
            font-size: 1.2rem; 
            margin-bottom: 1.5rem; 
            outline: none; 
            text-align: center; 
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .student-code-input:focus { 
            border-color: var(--info-color); 
            box-shadow: 0 0 0 4px rgba(66, 153, 225, 0.1);
            transform: translateY(-2px);
        }
        
        body.dark-mode .student-code-input {
            background: #1a202c;
            color: var(--dark-text);
            border-color: #4a5568;
        }
        
        /* Button Styling */
        .access-btn { 
            background: linear-gradient(135deg, var(--success-color) 0%, #38a169 100%); 
            color: white; 
            border: none; 
            padding: 18px 45px; 
            border-radius: 15px; 
            cursor: pointer; 
            font-size: 1.2rem; 
            font-weight: bold; 
            letter-spacing: 1px; 
            width: 100%; 
            transition: all 0.3s ease;
        }
        
        .access-btn:hover { 
            transform: translateY(-3px); 
            box-shadow: 0 20px 40px rgba(72, 187, 120, 0.3);
        }
        
        /* Loading Bar */
        .loading-bar {
            width: 100%;
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            overflow: hidden;
            margin: 1rem 0;
            display: none;
        }
        
        .loading-progress {
            height: 100%;
            background: linear-gradient(90deg, var(--info-color), var(--success-color));
            width: 0%;
            transition: width 0.3s ease;
        }
        
        /* Question Sets */
        .set-selection-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 2rem; 
            margin: 2rem 0; 
        }
        
        .set-card { 
            background: white; 
            border: 3px solid #e2e8f0; 
            border-radius: 20px; 
            padding: 2rem; 
            text-align: center; 
            cursor: pointer; 
            transition: all 0.4s ease;
        }
        
        .set-card:hover { 
            border-color: var(--info-color); 
            transform: translateY(-10px) scale(1.02); 
            box-shadow: 0 25px 50px rgba(66, 153, 225, 0.2);
        }
        
        body.dark-mode .set-card {
            background: #1a202c;
            border-color: #4a5568;
        }
        
        .set-icon { 
            font-size: 3rem; 
            margin-bottom: 1rem;
        }
        
        .set-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 0.5rem;
        }
        
        body.dark-mode .set-title { color: var(--dark-text); }
        
        .set-description {
            color: #4a5568;
            font-size: 1rem;
            margin-bottom: 1.5rem;
            font-weight: 500;
        }
        
        body.dark-mode .set-description { color: #a0aec0; }
        
        .set-info {
            background: #f7fafc;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid #4299e1;
        }
        
        body.dark-mode .set-info { background: #2d3748; }
        
        .set-info div {
            margin: 0.3rem 0;
            font-size: 0.9rem;
            color: #2d3748;
        }
        
        body.dark-mode .set-info div { color: var(--dark-text); }
        
        .set-topics {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
        }
        
        .topic-tag {
            background: #bee3f8;
            color: #2c5282;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        /* Student Info */
        .student-info-card {
            background: #f8f9fa;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 2rem;
            margin: 1rem 0;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        body.dark-mode .student-info-card {
            background: #1a202c;
            border-color: #4a5568;
        }
        
        .student-info-card h2 {
            color: #2d3748;
            margin-bottom: 1.5rem;
            text-align: center;
            font-size: 1.5rem;
        }
        
        body.dark-mode .student-info-card h2 { color: var(--dark-text); }
        
        .student-details {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            border-left: 4px solid #4299e1;
        }
        
        body.dark-mode .student-details { background: #2d3748; }
        
        .student-details p {
            margin: 0.5rem 0;
            font-size: 1.1rem;
            color: #2d3748;
        }
        
        body.dark-mode .student-details p { color: var(--dark-text); }
        
        .selected-set-info {
            background: #c6f6d5;
            border: 2px solid #38a169;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            text-align: center;
        }
        
        .selected-set-text {
            color: #22543d;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        /* Exam Instructions */
        .exam-instructions {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            border-left: 4px solid #48bb78;
        }
        
        body.dark-mode .exam-instructions { background: #2d3748; }
        
        .exam-instructions h3 {
            color: #2d3748;
            margin-bottom: 1rem;
        }
        
        body.dark-mode .exam-instructions h3 { color: var(--dark-text); }
        
        .exam-instructions ul {
            list-style: none;
            padding: 0;
        }
        
        .exam-instructions li {
            margin: 0.8rem 0;
            padding: 0.5rem;
            background: #f7fafc;
            border-radius: 5px;
            font-size: 0.95rem;
            color: #2d3748;
        }
        
        body.dark-mode .exam-instructions li {
            background: #1a202c;
            color: var(--dark-text);
        }
        
        /* Buttons */
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 0.5rem;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .start-exam-btn {
            width: 100%;
            font-size: 1.2rem;
            padding: 15px;
        }
        
        /* Exam Interface */
        .exam-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: linear-gradient(145deg, #f7fafc, #edf2f7);
            border-radius: 15px;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        body.dark-mode .exam-header {
            background: linear-gradient(145deg, #1a202c, #2d3748);
        }
        
        .timer {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--error-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(229, 62, 62, 0.1);
            border-radius: 10px;
        }
        
        .progress {
            font-size: 1.1rem;
            color: #4a5568;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        body.dark-mode .progress { color: var(--dark-text); }
        
        /* Question Container */
        .question-container {
            margin-bottom: 2rem;
            padding: 2rem;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            transition: opacity 0.3s ease;
        }
        
        body.dark-mode .question-container {
            background: linear-gradient(145deg, #2d3748, #1a202c);
            border-color: #4a5568;
        }
        
        .question {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 1.5rem;
            line-height: 1.6;
            padding: 1rem;
            background: rgba(66, 153, 225, 0.05);
            border-radius: 10px;
            border-left: 4px solid var(--info-color);
        }
        
        body.dark-mode .question {
            color: var(--dark-text);
            background: rgba(66, 153, 225, 0.1);
        }
        
        /* Options */
        .options {
            display: grid;
            gap: 1rem;
        }
        
        .option {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #ffffff;
        }
        
        .option:hover {
            border-color: #cbd5e0;
            background: #f7fafc;
            transform: translateX(5px);
        }
        
        .option input[type="radio"] {
            margin-right: 15px;
            transform: scale(1.3);
            accent-color: var(--info-color);
        }
        
        .option.selected {
            border-color: var(--info-color);
            background: linear-gradient(145deg, #ebf8ff, #bee3f8);
            transform: translateX(5px);
        }
        
        body.dark-mode .option {
            background: #1a202c;
            border-color: #4a5568;
            color: var(--dark-text);
        }
        
        body.dark-mode .option:hover {
            background: #2d3748;
        }
        
        body.dark-mode .option.selected {
            background: linear-gradient(145deg, #1a365d, #2c5282);
            border-color: var(--info-color);
        }
        
        /* Skip Option */
        .skip-option {
            background: linear-gradient(145deg, #fff5b0, #faf089) !important;
            border-color: var(--warning-color) !important;
            color: #744210 !important;
            font-weight: bold;
        }
        
        .skip-option:hover {
            background: linear-gradient(145deg, #faf089, #f6e05e) !important;
        }
        
        .skip-option.selected {
            background: linear-gradient(145deg, #f6e05e, #d69e2e) !important;
        }
        
        /* Navigation */
        .navigation {
            display: flex;
            justify-content: space-between;
            margin: 2rem 0;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .btn-nav {
            background: linear-gradient(135deg, #4a5568, #2d3748);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-nav:hover {
            background: linear-gradient(135deg, #2d3748, #1a202c);
            transform: translateY(-2px);
        }
        
        .btn-nav:disabled {
            background: #a0aec0;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Submit Button */
        .submit-btn {
            background: linear-gradient(135deg, var(--success-color) 0%, #38a169 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.3rem;
            font-weight: 600;
            display: block;
            margin: 2rem auto;
            transition: all 0.3s ease;
        }
        
        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(72, 187, 120, 0.3);
        }
        
        /* Results Section */
        .result-section {
            text-align: center;
            padding: 2rem;
            background: linear-gradient(145deg, #f7fafc, #edf2f7);
            border-radius: 20px;
            margin: 1rem 0;
        }
        
        body.dark-mode .result-section {
            background: linear-gradient(145deg, #1a202c, #2d3748);
        }
        
        .score {
            font-size: 3rem;
            font-weight: bold;
            margin: 1.5rem 0;
        }
        
        .score.pass {
            color: var(--success-color);
            animation: success-pulse 2s infinite;
        }
        
        .score.fail {
            color: var(--error-color);
        }
        
        @keyframes success-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* Progress Circle */
        .progress-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(var(--success-color) 0%, #e2e8f0 0%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 2rem auto;
            position: relative;
        }
        
        .progress-circle::before {
            content: '';
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: white;
            position: absolute;
        }
        
        body.dark-mode .progress-circle::before {
            background: var(--dark-card);
        }
        
        .progress-text {
            position: relative;
            z-index: 1;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        /* Achievement Badges */
        .achievement-badges {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }
        
        .badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            color: white;
        }
        
        .badge.excellent { background: linear-gradient(45deg, #48bb78, #38a169); }
        .badge.good { background: linear-gradient(45deg, #4299e1, #3182ce); }
        .badge.average { background: linear-gradient(45deg, #d69e2e, #b7791f); }
        .badge.poor { background: linear-gradient(45deg, #e53e3e, #c53030); }
        
        /* Password Modal */
        .password-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
        }
        
        .password-modal-content {
            background-color: #fefefe;
            margin: 8% auto;
            padding: 3rem;
            border-radius: 25px;
            width: 90%;
            max-width: 550px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.4);
            text-align: center;
        }
        
        body.dark-mode .password-modal-content {
            background: var(--dark-card);
            color: var(--dark-text);
        }
        
        .password-input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #cbd5e0;
            border-radius: 10px;
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            outline: none;
            text-align: center;
            font-weight: 500;
        }
        
        .password-input:focus {
            border-color: #c53030;
            box-shadow: 0 0 0 3px rgba(197, 48, 48, 0.1);
        }
        
        body.dark-mode .password-input {
            background: #1a202c;
            color: var(--dark-text);
            border-color: #4a5568;
        }
        
        .password-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }
        
        .password-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .password-btn-submit {
            background: linear-gradient(135deg, #c53030 0%, #9c2626 100%);
            color: white;
        }
        
        .password-btn-cancel {
            background: #e2e8f0;
            color: #4a5568;
        }
        
        .password-btn:hover {
            transform: translateY(-2px);
        }
        
        /* Notification System */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 3000;
            padding: 1rem 2rem;
            border-radius: 15px;
            font-weight: 600;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .notification.success {
            background: linear-gradient(135deg, var(--success-color), #38a169);
            color: white;
        }
        
        .notification.error {
            background: linear-gradient(135deg, var(--error-color), #c53030);
            color: white;
        }
        
        .notification.warning {
            background: linear-gradient(135deg, var(--warning-color), #b7791f);
            color: white;
        }
        
        .notification.info {
            background: linear-gradient(135deg, var(--info-color), #3182ce);
            color: white;
        }
        
        /* Certificate Button */
        .certificate-btn {
            background: linear-gradient(135deg, #9f7aea 0%, #805ad5 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            margin: 1rem 0.5rem;
            transition: all 0.3s ease;
        }
        
        .certificate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(159, 122, 234, 0.3);
        }
        
        /* Contact Info */
        .contact-info {
            color: #e53e3e;
            font-size: 0.9rem;
            font-weight: 500;
            margin-top: 1rem;
        }
        
        /* Hidden Classes */
        .hidden { display: none !important; }
        .set-selection-section, 
        .student-info-section, 
        .exam-section, 
        .result-section, 
        .review-section,
        .admin-section { display: none; }
        
        .header { 
            text-align: center; 
            margin-bottom: 2rem; 
            display: none; 
        }
        
        .header h1 { 
            color: #4a5568; 
            margin-bottom: 0.5rem; 
            font-size: 2.5rem; 
        }
        
        .header p { 
            color: #718096; 
            font-size: 1.2rem; 
        }
        
        body.dark-mode .header h1 { color: var(--dark-text); }
        body.dark-mode .header p { color: #a0aec0; }
        
        /* Review Section */
        .review-section {
            padding: 2rem;
            background: linear-gradient(145deg, #f7fafc, #edf2f7);
            border-radius: 20px;
            margin: 1rem 0;
        }
        
        body.dark-mode .review-section {
            background: linear-gradient(145deg, #1a202c, #2d3748);
        }
        
        .review-question {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        body.dark-mode .review-question {
            background: #2d3748;
            border-color: #4a5568;
        }
        
        .review-question .option.correct {
            background: #c6f6d5;
            border-color: #38a169;
            color: #22543d;
        }
        
        .review-question .option.wrong {
            background: #fed7d7;
            border-color: #e53e3e;
            color: #742a2a;
        }
        
        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .container { padding: 1rem; }
            .institute-name { font-size: 1.5rem; }
            .set-selection-grid { grid-template-columns: 1fr; }
            .exam-header { flex-direction: column; }
            .score { font-size: 2rem; }
            .navigation { flex-direction: column; }
            .password-buttons { flex-direction: column; }
            .achievement-badges { justify-content: center; }
        }
    </style>
</head>
<body>
    <!-- Theme Toggle -->
    <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">üåô Dark</button>
    
    <!-- Admin Toggle -->
    <button class="admin-toggle" onclick="toggleAdmin()" id="adminToggle">üë®‚Äçüíº Admin</button>
    
    <!-- Animated Background -->
    <div class="bg-animation">
        <div class="floating-shape" style="top: 10%; left: 10%; font-size: 2rem;">üìä</div>
        <div class="floating-shape" style="top: 20%; right: 15%; font-size: 1.5rem; animation-delay: -2s;">üíª</div>
        <div class="floating-shape" style="bottom: 20%; left: 20%; font-size: 1.8rem; animation-delay: -4s;">üìà</div>
        <div class="floating-shape" style="bottom: 30%; right: 10%; font-size: 2.2rem; animation-delay: -1s;">üéØ</div>
    </div>

    <div class="container">
        <!-- Home Section -->
        <div class="home-section" id="homeSection">
            <div class="institute-header">
                <div class="institute-logo">üñ•Ô∏è</div>
                <h1 class="institute-name">JATIYA YUVA COMPUTER CENTER MANKUNDU</h1>
                <p class="institute-location">üìç Mankundu, Hooghly</p>
            </div>
            <div class="access-card">
                <div class="graduation-icon">üéì</div>
                <h2 class="access-title">üîí Student Access Required</h2>
                <p class="access-description">Enter your Student Code to access the Advanced MS Excel Practice Test System</p>
                <div class="student-input-section">
                    <input type="text" id="studentCode" class="student-code-input" placeholder="Enter Student Code" maxlength="15">
                    <div class="loading-bar" id="loadingBar">
                        <div class="loading-progress" id="loadingProgress"></div>
                    </div>
                    <button class="access-btn" onclick="accessTest()">üöÄ ACCESS TEST</button>
                </div>
                <div class="contact-info">üìû Contact your instructor if you don't have a student code</div>
            </div>
        </div>

        <!-- Header -->
        <div class="header" id="examHeader">
            <h1>üî• Advanced MS Excel MCQ Exam</h1>
            <p>Next-Generation Computer Institute Assessment</p>
        </div>
        
        <!-- Admin Section -->
        <div class="admin-section" id="adminSection">
            <div class="student-info-card">
                <h2>üë®‚Äçüíº Admin Dashboard</h2>
                <div class="student-details">
                    <p><strong>üè¢ System Status:</strong> Online</p>
                    <p><strong>üë• Total Students:</strong> 48 Registered</p>
                    <p><strong>üìä Active Exams:</strong> 0 Currently Running</p>
                    <p><strong>üîí Security Level:</strong> High</p>
                </div>
                <div class="exam-instructions">
                    <h3>üõ†Ô∏è Admin Features:</h3>
                    <ul>
                        <li>üë• <strong>Student Management:</strong> Add, edit, remove students</li>
                        <li>‚ùì <strong>Question Bank:</strong> Manage questions and sets</li>
                        <li>üìä <strong>Analytics:</strong> View exam results and statistics</li>
                        <li>üèÜ <strong>Final Exam Records:</strong> View all Final Exam scores</li>
                        <li>üîê <strong>Security:</strong> Password management and access control</li>
                        <li>üì§ <strong>Export:</strong> Download results and reports</li>
                        <li>‚öôÔ∏è <strong>Settings:</strong> Configure system parameters</li>
                    </ul>
                    <div style="margin-top: 2rem;">
                        <button class="btn" onclick="showFinalExamRecords()" style="margin: 0.5rem;">üìä View Final Exam Records</button>
                        <button class="btn" onclick="exportFinalExamScores()" style="margin: 0.5rem;">üì§ Export Final Scores</button>
                        <button class="btn" onclick="clearFinalExamRecords()" style="margin: 0.5rem; background: #e53e3e;">üóëÔ∏è Clear All Records</button>
                    </div>
                </div>
                <button class="btn start-exam-btn" onclick="toggleAdmin()">üîô Back to Main System</button>
            </div>
        </div>
        
        <!-- Set Selection Section -->
        <div class="set-selection-section" id="setSelectionSection">
            <div class="student-info-card">
                <h2>üìö Select Question Set</h2>
                <div id="studentDetailsSet" class="student-details"></div>
                <div class="set-selection-grid">
                    <div class="set-card" onclick="selectQuestionSet('A')">
                        <div class="set-icon">üìù</div>
                        <div class="set-title">SET A</div>
                        <div class="set-description">Basic to Intermediate Level</div>
                        <div class="set-info">
                            <div>‚úÖ 25 Questions</div>
                            <div>‚è∞ 35 Minutes</div>
                            <div>üéØ Functions, Formulas & Features</div>
                            <div>üìä Pass: 60% (15/25)</div>
                        </div>
                        <div class="set-topics">
                            <span class="topic-tag">SUM</span>
                            <span class="topic-tag">VLOOKUP</span>
                            <span class="topic-tag">IF Functions</span>
                            <span class="topic-tag">Charts</span>
                            <span class="topic-tag">Shortcuts</span>
                        </div>
                    </div>
                    
                    <div class="set-card" onclick="selectQuestionSet('B')">
                        <div class="set-icon">üìä</div>
                        <div class="set-title">SET B</div>
                        <div class="set-description">Intermediate to Advanced Level</div>
                        <div class="set-info">
                            <div>‚úÖ 25 Questions</div>
                            <div>‚è∞ 35 Minutes</div>
                            <div>üéØ Advanced Functions & Analysis</div>
                            <div>üìä Pass: 60% (15/25)</div>
                        </div>
                        <div class="set-topics">
                            <span class="topic-tag">Pivot Tables</span>
                            <span class="topic-tag">IFERROR</span>
                            <span class="topic-tag">SUMIF</span>
                            <span class="topic-tag">Data Analysis</span>
                            <span class="topic-tag">Named Ranges</span>
                        </div>
                    </div>
                    
                    <div class="set-card" onclick="selectQuestionSet('C')">
                        <div class="set-icon">‚ö°</div>
                        <div class="set-title">SET C</div>
                        <div class="set-description">Expert Level Challenge</div>
                        <div class="set-info">
                            <div>‚úÖ 25 Questions</div>
                            <div>‚è∞ 35 Minutes</div>
                            <div>üéØ Expert Functions & Automation</div>
                            <div>üìä Pass: 60% (15/25)</div>
                        </div>
                        <div class="set-topics">
                            <span class="topic-tag">Array Formulas</span>
                            <span class="topic-tag">LAMBDA</span>
                            <span class="topic-tag">Power Query</span>
                            <span class="topic-tag">XLOOKUP</span>
                            <span class="topic-tag">VBA Basics</span>
                        </div>
                    </div>
                    
                    <div class="set-card" onclick="requestFinalTestAccess()" style="border: 3px solid #ff6b35; background: linear-gradient(135deg, #fff5f5 0%, #fed7d7 100%);">
                        <div class="set-icon">üèÜ</div>
                        <div class="set-title" style="color: #c53030;">FINAL TEST</div>
                        <div class="set-description" style="color: #9c2626;">Comprehensive Assessment</div>
                        <div class="set-info" style="background: #fff; border-left: 4px solid #ff6b35;">
                            <div>‚úÖ 40 Questions</div>
                            <div>‚è∞ 60 Minutes</div>
                            <div>üéØ Complete Excel Mastery Test</div>
                            <div>üìä Pass: 70% (28/40)</div>
                            <div style="color: #c53030; font-weight: bold;">üîí Password Protected</div>
                        </div>
                        <div class="set-topics">
                            <span class="topic-tag" style="background: #fed7d7; color: #c53030;">Mixed Levels</span>
                            <span class="topic-tag" style="background: #fed7d7; color: #c53030;">All Topics</span>
                            <span class="topic-tag" style="background: #fed7d7; color: #c53030;">Comprehensive</span>
                            <span class="topic-tag" style="background: #fed7d7; color: #c53030;">Instructor Access</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Student Info Section -->
        <div class="student-info-section" id="studentInfoSection">
            <div class="student-info-card">
                <h2>üìã Student Information</h2>
                <div id="studentDetails" class="student-details"></div>
                <div class="selected-set-info">
                    <div class="selected-set-text" id="selectedSetDisplay">üìù Selected: MS Excel Question Set A</div>
                </div>
                <div class="exam-instructions">
                    <h3 id="examInstructions">üìù Exam Instructions:</h3>
                    <ul id="instructionsList">
                        <li>‚è∞ <strong>Time Limit:</strong> 35 minutes</li>
                        <li>üìä <strong>Questions:</strong> 25 Multiple Choice Questions</li>
                        <li>‚úÖ <strong>Passing Score:</strong> 60% (15 correct answers)</li>
                        <li>‚è≠Ô∏è <strong>Skip Option:</strong> You can skip questions and return later</li>
                        <li>üîÑ <strong>Navigation:</strong> Use Previous/Next buttons to move between questions</li>
                        <li>üì§ <strong>Auto-Submit:</strong> Exam will auto-submit when time expires</li>
                        <li>üéØ <strong>Smart Features:</strong> Progress tracking, visual feedback, and performance analytics</li>
                    </ul>
                </div>
                <button class="btn start-exam-btn" onclick="startExam()">üöÄ Start Advanced Excel Exam</button>
            </div>
        </div>
        
        <!-- Exam Section -->
        <div class="exam-section" id="examSection">
            <div class="exam-header">
                <div class="progress" id="progress">
                    <span>üìä</span>
                    <span>Question 1 of 25</span>
                </div>
                <div class="timer" id="timer">
                    <span>‚è∞</span>
                    <span>35:00</span>
                </div>
            </div>
            <div class="question-container" id="questionContainer"></div>
            <div class="navigation">
                <div style="display: flex; gap: 1rem;">
                    <button class="btn-nav" id="prevBtn" onclick="previousQuestion()" disabled>
                        <span>‚¨ÖÔ∏è</span>
                        <span>Previous</span>
                    </button>
                    <button class="btn-nav" id="nextBtn" onclick="nextQuestion()">
                        <span>Next</span>
                        <span>‚û°Ô∏è</span>
                    </button>
                </div>
                <div>
                    <button class="btn-nav" onclick="showQuestionMap()">üó∫Ô∏è Question Map</button>
                </div>
            </div>
            <div style="text-align: center; margin: 2rem 0;">
                <button class="submit-btn" id="submitBtn" onclick="submitExam()" style="display: none;">
                    <span>‚úÖ Submit Exam</span>
                </button>
            </div>
        </div>
        
        <!-- Result Section -->
        <div class="result-section" id="resultSection">
            <h2>üéâ Exam Completed!</h2>
            <div class="progress-circle" id="progressCircle">
                <div class="progress-text" id="progressText">0%</div>
            </div>
            <div class="score" id="scoreDisplay"></div>
            <div class="achievement-badges" id="achievementBadges"></div>
            <div id="resultMessage"></div>
            <div style="margin-top: 2rem;">
                <button class="btn" onclick="showReview()">üìù Review Answers</button>
                <button class="certificate-btn" onclick="generateCertificate()" id="certificateBtn" style="display: none;">
                    üèÜ Generate Certificate
                </button>
                <button class="btn" onclick="restartExam()">üîÑ Take Another Exam</button>
            </div>
        </div>
        
        <!-- Review Section -->
        <div class="review-section" id="reviewSection">
            <h2>üìñ Detailed Answer Review</h2>
            <div id="reviewContainer"></div>
            <button class="btn" onclick="goBackToResult()">‚¨ÖÔ∏è Back to Results</button>
        </div>
    </div>

    <!-- Password Modal for Final Test -->
    <div id="passwordModal" class="password-modal">
        <div class="password-modal-content">
            <h3>üîí Final Test Access</h3>
            <p>This is a secured comprehensive examination. Please enter the password provided by your instructor to access the Final Test.</p>
            <input type="password" id="finalTestPassword" class="password-input" placeholder="Enter Final Test Password" maxlength="20">
            <div class="password-buttons">
                <button class="password-btn password-btn-submit" onclick="verifyFinalTestPassword()">üîì Access Test</button>
                <button class="password-btn password-btn-cancel" onclick="closeFinalTestModal()">‚ùå Cancel</button>
            </div>
            <div style="margin-top: 1.5rem; font-size: 0.9rem; color: #718096;">
                üéì Contact your instructor if you don't have the password<br>
                <small>Advanced security measures are in place for this assessment</small>
            </div>
        </div>
    </div>

    <!-- Final Exam Records Modal -->
    <div id="finalRecordsModal" class="password-modal">
        <div class="password-modal-content" style="max-width: 800px; max-height: 80vh; overflow-y: auto;">
            <h3>üèÜ Final Exam Records</h3>
            <div id="finalRecordsContainer"></div>
            <div style="margin-top: 1.5rem;">
                <button class="btn" onclick="closeFinalRecordsModal()">‚úÖ Close</button>
                <button class="btn" onclick="exportFinalExamScores()" style="background: #48bb78;">üì§ Export Data</button>
            </div>
        </div>
    </div>

    <!-- Submit Confirmation Modal -->
    <div id="submitModal" class="password-modal">
        <div class="password-modal-content">
            <h3>ü§î Submit Confirmation</h3>
            <div id="submitModalMessage"></div>
            <div class="password-buttons">
                <button class="password-btn password-btn-submit" onclick="confirmSubmission()">‚úÖ Yes, Submit Exam</button>
                <button class="password-btn password-btn-cancel" onclick="cancelSubmission()">‚ùå Cancel, Continue Exam</button>
            </div>
        </div>
    </div>

    <!-- Question Map Modal -->
    <div id="questionMapModal" class="password-modal">
        <div class="password-modal-content">
            <h3>üó∫Ô∏è Question Navigation Map</h3>
            <div id="questionMapGrid"></div>
            <button class="btn" onclick="closeQuestionMap()">‚úÖ Close Map</button>
        </div>
    </div>

    <script>
        // Student database
        var students = {
            'JYCC2024004': {name: 'ARPITA DEBNATH', course: 'DFA', joinDate: '2024-01-15'},
            'JYCC2024006': {name: 'BARNALI ACHARYA', course: 'DFA', joinDate: '2024-01-20'},
            'JYCC2024013': {name: 'PREETAM CHAKRABORTY', course: 'DFA', joinDate: '2024-02-01'},
            'JYCC2024014': {name: 'IPSHITA SAMANTA', course: 'CA', joinDate: '2024-02-01'},
            'JYCC2024015': {name: 'SUBRATA MALIK', course: 'DFA', joinDate: '2024-02-01'},
            'JYCC2024025': {name: 'SAIKAT DEY', course: 'ADCA', joinDate: '2024-02-01'},
            'JYCC2024027': {name: 'SWASTIKA BISWAS', course: 'ADIT', joinDate: '2024-02-05'},
            'JYCC2024032': {name: 'SUCHARITA PATRA', course: 'DFA', joinDate: '2024-02-05'},
            'JYCC2024042': {name: 'DIP SADHUKHAN', course: 'TALLY WITH GST', joinDate: '2024-02-10'},
            'JYCC2024045': {name: 'SRIJA KUNDU', course: 'ADIT+COMS', joinDate: '2024-02-10'},
            'JYCC2024048': {name: 'SUBHADIP SEAL', course: 'DFA', joinDate: '2024-02-12'},
            'JYCC2024049': {name: 'ARIJIT PRAMANICK', course: 'TALLY WITH GST', joinDate: '2024-02-12'},
            'JYCC2024050': {name: 'JYOTI RAY', course: 'DFA', joinDate: '2024-02-15'},
            'JYCC2024053': {name: 'SWARNENDU DAS', course: 'DFA', joinDate: '2024-02-15'},
            'JYCC2024056': {name: 'AYAN GHOSH', course: 'DFA', joinDate: '2024-02-18'},
            'JYCC2024060': {name: 'SUDIPTA DAS', course: 'DFA', joinDate: '2024-02-20'},
            'JYCC2024061': {name: 'PRANAB PAL', course: 'DFA', joinDate: '2024-02-20'},
            'JYCC2024065': {name: 'TIYASHA DAS', course: 'ADCA', joinDate: '2024-02-22'},
            'JYCC2024091': {name: 'SOUNAK DAS', course: 'ADCA', joinDate: '2024-03-01'},
            'JYCC2024092': {name: 'PAYAL DAS', course: 'ADCA', joinDate: '2024-03-01'},
            'JYCC2024093': {name: 'SOURAV SARKAR', course: 'ADCA', joinDate: '2024-03-01'},
            'JYCC2024094': {name: 'SAGAR DEY', course: 'ADCA', joinDate: '2024-03-01'},
            'JYCC2024095': {name: 'SIBAM DAS', course: 'ADCA', joinDate: '2024-03-01'},
            'JYCC2024096': {name: 'DEBASISH KUNDU', course: 'ADCA', joinDate: '2024-03-01'},
            'JYCC2024097': {name: 'SAYAN MUKHERJEE', course: 'ADCA', joinDate: '2024-03-01'},
            'JYCC2024098': {name: 'RAJIB CHAKRABORTY', course: 'ADCA', joinDate: '2024-03-01'},
            'JYCC2024099': {name: 'SOUGATA MANDAL', course: 'ADCA', joinDate: '2024-03-01'},
            'JYCC2024100': {name: 'TIRTHARAJ PAL', course: 'ADCA', joinDate: '2024-03-01'},
            'JYCC2024170': {name: 'SNEHA SHAW', course: 'ADCA', joinDate: '2024-03-15'},
            'JYCC2024634': {name: 'GANESH PRADHAN', course: 'MS OFFICE 2013', joinDate: '2024-05-01'},
            'JYCC2024657': {name: 'NILADRI DEY', course: 'ADCA', joinDate: '2024-05-05'},
            'JYCC2024673': {name: 'SUBHANJANA BANERJEE', course: 'DFA', joinDate: '2024-05-10'},
            'JYCC2024674': {name: 'SHREYA MAITRA', course: 'DFA', joinDate: '2024-05-10'},
            'JYCC2024698': {name: 'ANKITA GHOSH', course: 'ADCA', joinDate: '2024-05-15'},
            'JYCC2024699': {name: 'SHANU GHOSH', course: 'ADCA', joinDate: '2024-05-15'},
            'JYCC2024708': {name: 'PRIYANGSHU DAS', course: 'ADCA', joinDate: '2024-05-18'},
            'JYCC2024713': {name: 'SUPRIYO KUNDU', course: 'ADIT', joinDate: '2024-05-20'},
            'JYCC2024714': {name: 'KAUSHIK PANDIT', course: 'DFA', joinDate: '2024-05-20'},
            'JYCC2024717': {name: 'PRAMIT DAS', course: 'ADCA', joinDate: '2024-05-22'},
            'JYCC2024718': {name: 'SRIDIP ADHIKARY', course: 'ADCA', joinDate: '2024-05-22'},
            'JYCC2024720': {name: 'SUBHADEEP BARUA', course: 'DFA', joinDate: '2024-05-25'},
            'JYCC2024724': {name: 'SANGITA PAL', course: 'DFA', joinDate: '2024-05-25'},
            'JYCC2024726': {name: 'SAYANTIKA SARKAR', course: 'ADCA', joinDate: '2024-05-28'},
            'JYCC2024731': {name: 'TANIA DAS', course: 'ADCA', joinDate: '2024-06-01'},
            'JYCC2024749': {name: 'ISHAN MALLICK', course: 'ADCA', joinDate: '2024-06-05'},
            'JYCC2024750': {name: 'TAPATI DEBNATH', course: 'DFA', joinDate: '2024-06-05'},
            'JYCC2024757': {name: 'SANA KHATUN', course: 'TALLY WITH GST', joinDate: '2024-06-08'},
            'JYCC2024789': {name: 'RAJAT ROY', course: 'ADCA', joinDate: '2024-06-15'},
            'JYCC2024799': {name: 'SNEHA HALDER', course: 'ADIT', joinDate: '2024-06-18'},
            'JYCC2024801': {name: 'ANIRUDDHA MONDAL', course: 'DFA', joinDate: '2024-06-20'},
            'TEST001': {name: 'TEST STUDENT', course: 'ADCA', joinDate: '2024-01-01'},
            'ADMIN001': {name: 'SYSTEM ADMIN', course: 'ADMIN', joinDate: '2024-01-01'}
        };
        
        var eligibleCourses = ['ADCA', 'DFA', 'CA', 'ADIT', 'ADIT+COMS', 'MS OFFICE 2013', 'TALLY WITH GST', 'ADMIN'];
        
        // Question sets - NOW WITH 25 QUESTIONS EACH!
        var questionSets = {
            'A': {
                title: 'MS Excel Question Set A - Basic to Intermediate',
                timeLimit: 2100, // 35 minutes
                passingScore: 60,
                questions: [
                    {question: "Which function is used to add a range of cells in Excel?", options: ["COUNT()", "SUM()", "AVERAGE()", "MAX()"], correct: 1},
                    {question: "What is the shortcut to bold selected text?", options: ["Ctrl+B", "Ctrl+Bold", "Alt+B", "Shift+B"], correct: 0},
                    {question: "Which function counts cells that meet a criteria?", options: ["COUNT()", "COUNTA()", "COUNTIF()", "COUNTBLANK()"], correct: 2},
                    {question: "What does Ctrl+D do in Excel?", options: ["Delete", "Duplicate", "Fill Down", "Data entry"], correct: 2},
                    {question: "Which function returns the absolute value of a number?", options: ["ABSOLUTE()", "ABS()", "POSITIVE()", "MAGNITUDE()"], correct: 1},
                    {question: "What is the correct syntax for the IF function?", options: ["IF(condition, value_if_true, value_if_false)", "IF(value_if_true, condition, value_if_false)", "IF(condition; value_if_true; value_if_false)", "IF[condition, value_if_true, value_if_false]"], correct: 0},
                    {question: "What does the VLOOKUP function do?", options: ["Looks up values vertically in a table", "Looks up values horizontally in a table", "Counts vertical values", "Sums vertical values"], correct: 0},
                    {question: "Which chart type is best for showing trends over time?", options: ["Pie chart", "Bar chart", "Line chart", "Scatter plot"], correct: 2},
                    {question: "What is the maximum number of rows in Excel 2019?", options: ["65,536", "1,048,576", "16,384", "256"], correct: 1},
                    {question: "What does Ctrl+Z do in Excel?", options: ["Redo", "Undo", "Cut", "Copy"], correct: 1},
                    {question: "Which function calculates the average of a range of cells?", options: ["MEAN()", "AVERAGE()", "AVG()", "MEDIAN()"], correct: 1},
                    {question: "What is the shortcut to save a workbook?", options: ["Ctrl+S", "Ctrl+W", "Alt+S", "F12"], correct: 0},
                    {question: "Which function finds the maximum value in a range?", options: ["MAX()", "MAXIMUM()", "LARGEST()", "TOP()"], correct: 0},
                    {question: "What does F2 do when a cell is selected?", options: ["Delete cell", "Edit cell", "Copy cell", "Format cell"], correct: 1},
                    {question: "Which function counts the number of non-empty cells?", options: ["COUNT()", "COUNTA()", "COUNTBLANK()", "COUNTNUMBER()"], correct: 1},
                    {question: "What is the shortcut to insert a new row?", options: ["Ctrl+Shift++", "Alt+I+R", "Ctrl+I", "Insert key"], correct: 0},
                    {question: "Which function returns the current date?", options: ["DATE()", "TODAY()", "NOW()", "CURRENT()"], correct: 1},
                    {question: "What does Ctrl+A do in Excel?", options: ["Select All", "Add function", "Apply format", "Arrange cells"], correct: 0},
                    {question: "Which tab contains the Insert Function option?", options: ["Home", "Insert", "Formulas", "Data"], correct: 2},
                    {question: "What is the default file extension for Excel workbooks?", options: [".xls", ".xlsx", ".xlsm", ".xml"], correct: 1},
                    {question: "Which function calculates the square root of a number?", options: ["SQRT()", "SQUARE()", "ROOT()", "POWER()"], correct: 0},
                    {question: "What does Ctrl+C do?", options: ["Cut", "Copy", "Clear", "Calculate"], correct: 1},
                    {question: "Which function rounds a number to a specified number of digits?", options: ["ROUND()", "ROUNDUP()", "ROUNDDOWN()", "All of the above"], correct: 3},
                    {question: "What is the shortcut to open Find & Replace dialog?", options: ["Ctrl+F", "Ctrl+H", "Ctrl+R", "F5"], correct: 1},
                    {question: "Which function returns the remainder after division?", options: ["MOD()", "REMAINDER()", "DIVIDE()", "MODULO()"], correct: 0}
                ]
            },
            'B': {
                title: 'MS Excel Question Set B - Intermediate to Advanced',
                timeLimit: 2100, // 35 minutes
                passingScore: 60,
                questions: [
                    {question: "What is the primary purpose of a Pivot Table in Excel?", options: ["Data entry", "Data summarization and analysis", "Chart creation", "Formula calculation"], correct: 1},
                    {question: "Which function can be used to find the second largest value in a range?", options: ["MAX()", "LARGE(range,2)", "SECOND()", "RANK()"], correct: 1},
                    {question: "What does the IFERROR function do?", options: ["Creates errors", "Returns a value if the formula results in an error", "Deletes errors", "Counts errors"], correct: 1},
                    {question: "Which function is used to extract the leftmost characters from a text string?", options: ["RIGHT()", "MID()", "LEFT()", "EXTRACT()"], correct: 2},
                    {question: "What does the SUMIF function do?", options: ["Sums all cells", "Sums cells that meet a specific criteria", "Counts cells", "Averages cells"], correct: 1},
                    {question: "What does the MATCH function do?", options: ["Compares values", "Returns the position of a value in a range", "Matches formatting", "Creates pairs"], correct: 1},
                    {question: "What is the purpose of Named Ranges in Excel?", options: ["Naming worksheets", "Assigning names to cell ranges for easier reference", "Creating charts", "Formatting cells"], correct: 1},
                    {question: "Which feature allows you to create dropdown lists in cells?", options: ["Data Validation", "Form Controls", "Conditional Formatting", "Cell Comments"], correct: 0},
                    {question: "Which function calculates the number of working days between two dates?", options: ["DAYS()", "NETWORKDAYS()", "WEEKDAY()", "WORKDAY()"], correct: 1},
                    {question: "What does the TRANSPOSE function do?", options: ["Moves data", "Converts rows to columns and vice versa", "Translates text", "Changes data type"], correct: 1},
                    {question: "Which function performs a conditional count with multiple criteria?", options: ["COUNTIFS()", "COUNTIF()", "SUMIFS()", "COUNT()"], correct: 0},
                    {question: "What does the CONCATENATE function do?", options: ["Joins text from multiple cells", "Separates text", "Formats text", "Counts characters"], correct: 0},
                    {question: "Which function returns the current date and time?", options: ["TODAY()", "NOW()", "TIME()", "DATETIME()"], correct: 1},
                    {question: "What is the purpose of the OFFSET function?", options: ["Returns a reference offset from a starting point", "Calculates percentages", "Formats cells", "Creates charts"], correct: 0},
                    {question: "Which function can be used to remove spaces from text?", options: ["TRIM()", "CLEAN()", "SUBSTITUTE()", "REPLACE()"], correct: 0},
                    {question: "What does AVERAGEIF function do?", options: ["Averages all cells", "Averages cells that meet criteria", "Finds median", "Calculates mode"], correct: 1},
                    {question: "Which function extracts a substring from the middle of text?", options: ["LEFT()", "RIGHT()", "MID()", "FIND()"], correct: 2},
                    {question: "What is the purpose of Data Validation?", options: ["Validate formulas", "Control what data can be entered in cells", "Check for errors", "Format data"], correct: 1},
                    {question: "Which function finds the position of text within another text?", options: ["SEARCH()", "FIND()", "LOCATE()", "Both A and B"], correct: 3},
                    {question: "What does the RANK function do?", options: ["Sorts data", "Returns the rank of a number in a list", "Creates rankings", "Arranges cells"], correct: 1},
                    {question: "Which function converts text to uppercase?", options: ["UPPER()", "LOWER()", "PROPER()", "CASE()"], correct: 0},
                    {question: "What is a Named Range in Excel?", options: ["A range with a custom name", "A formatted range", "A protected range", "A hidden range"], correct: 0},
                    {question: "Which function calculates the standard deviation of a sample?", options: ["STDEV()", "STDEV.S()", "STDEVP()", "Both A and B"], correct: 3},
                    {question: "What does the HLOOKUP function do?", options: ["Horizontal lookup in a table", "Vertical lookup in a table", "Lookup help", "Hide lookup"], correct: 0},
                    {question: "Which function returns the number of characters in a text string?", options: ["LEN()", "LENGTH()", "COUNT()", "SIZE()"], correct: 0}
                ]
            },
            'C': {
                title: 'MS Excel Question Set C - Expert Level Challenge',
                timeLimit: 2100, // 35 minutes
                passingScore: 60,
                questions: [
                    {question: "What does the XLOOKUP function offer over VLOOKUP?", options: ["Bidirectional lookup", "Better error handling", "Default value on no match", "All of the above"], correct: 3},
                    {question: "Which combination of functions can replace VLOOKUP for more flexibility?", options: ["INDEX + MATCH", "LOOKUP + FIND", "SEARCH + OFFSET", "CHOOSE + ROW"], correct: 0},
                    {question: "What does SUMPRODUCT function primarily do?", options: ["Multiplies ranges and sums results", "Adds product names", "Counts products", "Finds product totals"], correct: 0},
                    {question: "What is the main advantage of INDEX-MATCH over VLOOKUP?", options: ["Can lookup to the left", "Faster performance", "More flexible", "All of the above"], correct: 3},
                    {question: "Which function can return multiple results in Excel 365?", options: ["VLOOKUP", "XLOOKUP", "FILTER", "HLOOKUP"], correct: 2},
                    {question: "What does the INDIRECT function allow you to do?", options: ["Create dynamic cell references", "Refer to other sheets", "Build references from text", "All of the above"], correct: 3},
                    {question: "In INDEX function, what does INDEX(A1:C10,3,2) return?", options: ["Value in 3rd row, 2nd column", "Value in 2nd row, 3rd column", "Error", "Range A3:B10"], correct: 0},
                    {question: "What is the syntax for SUMPRODUCT with multiple criteria?", options: ["SUMPRODUCT((criteria1)*(criteria2)*values)", "SUMPRODUCT(criteria1,criteria2,values)", "SUMPRODUCT(IF(criteria1,criteria2,values))", "All are valid"], correct: 0},
                    {question: "Which function combination can create a two-way lookup?", options: ["INDEX(MATCH,MATCH)", "VLOOKUP + HLOOKUP", "XLOOKUP twice", "INDIRECT + MATCH"], correct: 0},
                    {question: "What is the main limitation of VLOOKUP compared to INDEX-MATCH?", options: ["Can only lookup to the right", "Slower performance", "Less accurate", "More complex syntax"], correct: 0},
                    {question: "Which function creates dynamic arrays in Excel 365?", options: ["UNIQUE()", "SORT()", "FILTER()", "All of the above"], correct: 3},
                    {question: "What does the LAMBDA function allow in Excel?", options: ["Create custom functions", "Loop through data", "Format cells", "All of the above"], correct: 0},
                    {question: "Which Power Query feature is used for data transformation?", options: ["Transform Data", "Get Data", "Close & Load", "Refresh"], correct: 0},
                    {question: "What is the purpose of the SEQUENCE function?", options: ["Generate a sequence of numbers", "Order data", "Create series", "Number cells"], correct: 0},
                    {question: "Which function performs advanced text manipulation with patterns?", options: ["REGEX()", "TEXTJOIN()", "CONCAT()", "None - Excel doesn't support regex"], correct: 3},
                    {question: "What does the SPILL error indicate in Excel 365?", options: ["Formula error", "Array formula can't display results", "Circular reference", "Invalid syntax"], correct: 1},
                    {question: "Which function can split text into multiple columns?", options: ["TEXTSPLIT()", "SPLIT()", "SEPARATE()", "DIVIDE()"], correct: 0},
                    {question: "What is the purpose of structured references in Excel tables?", options: ["Reference table data by column names", "Create relationships", "Format tables", "Sort data"], correct: 0},
                    {question: "Which advanced feature allows connecting to external data sources?", options: ["Power Query", "Power Pivot", "Data Model", "All of the above"], correct: 3},
                    {question: "What does the CHOOSECOLS function do in Excel 365?", options: ["Selects specific columns from an array", "Chooses random columns", "Colors columns", "Counts columns"], correct: 0},
                    {question: "Which function creates a random sample from a dataset?", options: ["RANDBETWEEN()", "SAMPLE()", "RANDOM()", "RANDARRAY()"], correct: 3},
                    {question: "What is the purpose of the LET function?", options: ["Define variables in formulas", "Create loops", "Format text", "Link cells"], correct: 0},
                    {question: "Which function can flatten a multi-dimensional array?", options: ["FLATTEN()", "TOCOL()", "TOROW()", "Both B and C"], correct: 3},
                    {question: "What does the MAKEARRAY function do?", options: ["Creates arrays with specified dimensions", "Makes array formulas", "Formats arrays", "Copies arrays"], correct: 0},
                    {question: "Which Excel feature allows building relationships between tables?", options: ["Data Model", "Pivot Tables", "Power Query", "VLOOKUP"], correct: 0},
                    {question: "What is the advantage of using XLOOKUP over INDEX-MATCH?", options: ["Simpler syntax", "Built-in error handling", "Can return multiple columns", "All of the above"], correct: 3}
                ]
            },
            'FINAL': {
                title: 'Final Comprehensive Excel Assessment - 40 Questions',
                timeLimit: 3600, // 60 minutes
                passingScore: 70,
                questions: [
                    // 10 questions from Set A (Basic to Intermediate)
                    {question: "Which function is used to add a range of cells in Excel?", options: ["COUNT()", "SUM()", "AVERAGE()", "MAX()"], correct: 1},
                    {question: "What is the shortcut to bold selected text?", options: ["Ctrl+B", "Ctrl+Bold", "Alt+B", "Shift+B"], correct: 0},
                    {question: "Which function counts cells that meet a criteria?", options: ["COUNT()", "COUNTA()", "COUNTIF()", "COUNTBLANK()"], correct: 2},
                    {question: "What does Ctrl+D do in Excel?", options: ["Delete", "Duplicate", "Fill Down", "Data entry"], correct: 2},
                    {question: "Which function returns the absolute value of a number?", options: ["ABSOLUTE()", "ABS()", "POSITIVE()", "MAGNITUDE()"], correct: 1},
                    {question: "What is the correct syntax for the IF function?", options: ["IF(condition, value_if_true, value_if_false)", "IF(value_if_true, condition, value_if_false)", "IF(condition; value_if_true; value_if_false)", "IF[condition, value_if_true, value_if_false]"], correct: 0},
                    {question: "Which chart type is best for showing trends over time?", options: ["Pie chart", "Bar chart", "Line chart", "Scatter plot"], correct: 2},
                    {question: "What is the maximum number of rows in Excel 2019?", options: ["65,536", "1,048,576", "16,384", "256"], correct: 1},
                    {question: "Which function calculates the average of a range of cells?", options: ["MEAN()", "AVERAGE()", "AVG()", "MEDIAN()"], correct: 1},
                    {question: "What is the shortcut to save a workbook?", options: ["Ctrl+S", "Ctrl+W", "Alt+S", "F12"], correct: 0},
                    
                    // 8 questions from Set B (Intermediate to Advanced)
                    {question: "What is the primary purpose of a Pivot Table in Excel?", options: ["Data entry", "Data summarization and analysis", "Chart creation", "Formula calculation"], correct: 1},
                    {question: "Which function can be used to find the second largest value in a range?", options: ["MAX()", "LARGE(range,2)", "SECOND()", "RANK()"], correct: 1},
                    {question: "What does the IFERROR function do?", options: ["Creates errors", "Returns a value if the formula results in an error", "Deletes errors", "Counts errors"], correct: 1},
                    {question: "Which function is used to extract the leftmost characters from a text string?", options: ["RIGHT()", "MID()", "LEFT()", "EXTRACT()"], correct: 2},
                    {question: "What does the SUMIF function do?", options: ["Sums all cells", "Sums cells that meet a specific criteria", "Counts cells", "Averages cells"], correct: 1},
                    {question: "Which feature allows you to create dropdown lists in cells?", options: ["Data Validation", "Form Controls", "Conditional Formatting", "Cell Comments"], correct: 0},
                    {question: "Which function calculates the number of working days between two dates?", options: ["DAYS()", "NETWORKDAYS()", "WEEKDAY()", "WORKDAY()"], correct: 1},
                    {question: "What does the CONCATENATE function do?", options: ["Joins text from multiple cells", "Separates text", "Formats text", "Counts characters"], correct: 0},
                    
                    // 7 questions from Set C (Expert Level)
                    {question: "What does the XLOOKUP function offer over VLOOKUP?", options: ["Bidirectional lookup", "Better error handling", "Default value on no match", "All of the above"], correct: 3},
                    {question: "Which combination of functions can replace VLOOKUP for more flexibility?", options: ["INDEX + MATCH", "LOOKUP + FIND", "SEARCH + OFFSET", "CHOOSE + ROW"], correct: 0},
                    {question: "What does SUMPRODUCT function primarily do?", options: ["Multiplies ranges and sums results", "Adds product names", "Counts products", "Finds product totals"], correct: 0},
                    {question: "What is the main advantage of INDEX-MATCH over VLOOKUP?", options: ["Can lookup to the left", "Faster performance", "More flexible", "All of the above"], correct: 3},
                    {question: "Which function can return multiple results in Excel 365?", options: ["VLOOKUP", "XLOOKUP", "FILTER", "HLOOKUP"], correct: 2},
                    {question: "What does the INDIRECT function allow you to do?", options: ["Create dynamic cell references", "Refer to other sheets", "Build references from text", "All of the above"], correct: 3},
                    {question: "Which function creates dynamic arrays in Excel 365?", options: ["UNIQUE()", "SORT()", "FILTER()", "All of the above"], correct: 3},
                    
                    // 15 NEW INTERMEDIATE QUESTIONS
                    {question: "Which function is used to find the minimum value in a range?", options: ["MIN()", "MINIMUM()", "SMALLEST()", "LOWEST()"], correct: 0},
                    {question: "What does the SUBSTITUTE function do?", options: ["Replaces old text with new text", "Substitutes formulas", "Changes cell format", "Swaps cell positions"], correct: 0},
                    {question: "Which function calculates the median of a range?", options: ["MIDDLE()", "MEDIAN()", "CENTER()", "MID()"], correct: 1},
                    {question: "What is the purpose of the ROUND function?", options: ["Makes cells circular", "Rounds numbers to specified decimal places", "Creates round charts", "Rounds up only"], correct: 1},
                    {question: "Which function converts a number to text?", options: ["TEXT()", "CONVERT()", "STRING()", "TOTEXT()"], correct: 0},
                    {question: "What does the PMT function calculate?", options: ["Payment amount", "Prime time", "Percentage", "Product total"], correct: 0},
                    {question: "Which function returns the current time?", options: ["TIME()", "NOW()", "CURRENT()", "CLOCK()"], correct: 1},
                    {question: "What does the COUNTBLANK function do?", options: ["Counts empty cells", "Counts all cells", "Blanks cells", "Counts formatted cells"], correct: 0},
                    {question: "Which function joins multiple text strings with a delimiter?", options: ["JOIN()", "TEXTJOIN()", "CONNECT()", "MERGE()"], correct: 1},
                    {question: "What is the purpose of the EOMONTH function?", options: ["End of month date", "End of year", "Employee of month", "Error of month"], correct: 0},
                    {question: "Which function calculates the number of days between two dates?", options: ["DAYS()", "DATEDIF()", "SUBTRACT()", "Both A and B"], correct: 3},
                    {question: "What does the PROPER function do?", options: ["Capitalizes first letter of each word", "Makes text uppercase", "Makes text lowercase", "Validates proper names"], correct: 0},
                    {question: "Which function returns a random number between two values?", options: ["RANDOM()", "RANDBETWEEN()", "RANDNUM()", "RANDOMIZE()"], correct: 1},
                    {question: "What is the purpose of conditional formatting?", options: ["Format cells based on their values", "Format conditions", "Create conditional formulas", "Format conditionally"], correct: 0},
                    {question: "Which function can extract the year from a date?", options: ["YEAR()", "GETYEAR()", "EXTRACTYEAR()", "DATEYEAR()"], correct: 0}
                ]
            }
        };
        
        // Global variables
        var currentQuestion = 0;
        var userAnswers = [];
        var timeLeft = 2100; // 35 minutes default
        var timer;
        var studentId = '';
        var currentStudentData = null;
        var examStarted = false;
        var selectedQuestionSet = 'A';
        var questions = [];
        var isDarkMode = false;
        var isAdminMode = false;
        var examResults = [];
        
        // Final Exam Score Storage
        var finalExamScores = JSON.parse(localStorage.getItem('finalExamScores') || '[]');
        
        // Function to save Final Exam score
        function saveFinalExamScore(studentData, score, totalQuestions, percentage, passed, timeTaken) {
            var scoreRecord = {
                studentCode: studentData.studentCode,
                studentName: studentData.studentName,
                course: studentData.course,
                score: score,
                totalQuestions: totalQuestions,
                percentage: percentage,
                passed: passed,
                timeTaken: timeTaken,
                date: new Date().toLocaleDateString(),
                timestamp: new Date().toLocaleString(),
                examType: 'FINAL'
            };
            
            // Check if student already has a Final Exam record
            var existingIndex = finalExamScores.findIndex(function(record) {
                return record.studentCode === studentData.studentCode;
            });
            
            if (existingIndex !== -1) {
                // Update existing record with better score or most recent attempt
                var existing = finalExamScores[existingIndex];
                if (percentage > existing.percentage || confirm('Student already has a Final Exam record (' + existing.percentage + '%). Do you want to replace it with this attempt (' + percentage + '%)?')) {
                    finalExamScores[existingIndex] = scoreRecord;
                    showNotification('üìù Final Exam score updated for ' + studentData.studentName, 'info', 3000);
                } else {
                    showNotification('üìù Previous Final Exam score retained for ' + studentData.studentName, 'warning', 3000);
                    return;
                }
            } else {
                // Add new record
                finalExamScores.push(scoreRecord);
                showNotification('üìù Final Exam score recorded for ' + studentData.studentName, 'success', 3000);
            }
            
            // Save to localStorage
            localStorage.setItem('finalExamScores', JSON.stringify(finalExamScores));
        }
        
        // Function to get all Final Exam scores
        function getAllFinalExamScores() {
            return finalExamScores.sort(function(a, b) {
                return b.percentage - a.percentage; // Sort by score descending
            });
        }
        
        // Function to get specific student's Final Exam score
        function getStudentFinalScore(studentCode) {
            return finalExamScores.find(function(record) {
                return record.studentCode === studentCode;
            });
        }
        
        // Final Test Security
        var finalTestPasswords = ['EXCEL2024', 'JYCC@FINAL', 'INSTRUCTOR123', 'ADMIN2024'];
        
        // Notification System
        function showNotification(message, type, duration) {
            var existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(function(n) { n.remove(); });
            
            var notification = document.createElement('div');
            notification.className = 'notification ' + type;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(function() {
                notification.remove();
            }, duration || 3000);
        }
        
        // Theme Toggle
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            document.getElementById('themeToggle').textContent = isDarkMode ? '‚òÄÔ∏è Light' : 'üåô Dark';
            showNotification('Switched to ' + (isDarkMode ? 'Dark' : 'Light') + ' mode', 'info', 2000);
        }
        
        // Admin Panel Toggle
        function toggleAdmin() {
            isAdminMode = !isAdminMode;
            if (isAdminMode) {
                hideAllSections();
                document.getElementById('adminSection').style.display = 'block';
                document.getElementById('examHeader').style.display = 'block';
                showNotification('Admin panel activated', 'info', 2000);
            } else {
                document.getElementById('adminSection').style.display = 'none';
                document.getElementById('examHeader').style.display = 'none';
                document.getElementById('homeSection').style.display = 'block';
                showNotification('Returned to main system', 'info', 2000);
            }
        }
        
        // Hide all sections
        function hideAllSections() {
            var sections = ['homeSection', 'setSelectionSection', 'studentInfoSection', 'examSection', 'resultSection', 'reviewSection', 'adminSection'];
            sections.forEach(function(id) {
                var element = document.getElementById(id);
                if (element) element.style.display = 'none';
            });
        }
        
        // Access test with loading
        function accessTest() {
            var code = document.getElementById('studentCode').value.trim().toUpperCase();
            if (!code) {
                showNotification('Please enter your Student Code', 'warning');
                return;
            }
            
            var loadingBar = document.getElementById('loadingBar');
            var loadingProgress = document.getElementById('loadingProgress');
            loadingBar.style.display = 'block';
            
            var progress = 0;
            var loadingInterval = setInterval(function() {
                progress += 10;
                loadingProgress.style.width = progress + '%';
                
                if (progress >= 100) {
                    clearInterval(loadingInterval);
                    loadingBar.style.display = 'none';
                    
                    if (!students[code]) {
                        showNotification('‚ùå Invalid Student Code! Please check and try again.', 'error');
                        return;
                    }
                    
                    var student = students[code];
                    if (eligibleCourses.indexOf(student.course) === -1) {
                        showNotification('‚ùå Course Restriction! Your course is not eligible for this exam.', 'error');
                        return;
                    }
                    
                    // Success
                    currentStudentData = student;
                    studentId = code;
                    
                    hideAllSections();
                    document.getElementById('examHeader').style.display = 'block';
                    document.getElementById('setSelectionSection').style.display = 'block';
                    
                    document.getElementById('studentDetailsSet').innerHTML = 
                        '<p><strong>üéì Student Name:</strong> ' + student.name + '</p>' +
                        '<p><strong>üÜî Student Code:</strong> ' + code + '</p>' +
                        '<p><strong>üìö Course:</strong> ' + student.course + '</p>' +
                        '<p><strong>üìÖ Join Date:</strong> ' + (student.joinDate || 'N/A') + '</p>';
                    
                    showNotification('Welcome ' + student.name + '! Please select your question set.', 'success');
                }
            }, 100);
        }
        
        // Final test access
        function requestFinalTestAccess() {
            document.getElementById('passwordModal').style.display = 'block';
            document.getElementById('finalTestPassword').focus();
        }
        
        function verifyFinalTestPassword() {
            var enteredPassword = document.getElementById('finalTestPassword').value.trim();
            if (!enteredPassword) {
                showNotification('‚ö†Ô∏è Please enter the password', 'warning');
                return;
            }
            
            if (finalTestPasswords.indexOf(enteredPassword) !== -1) {
                document.getElementById('passwordModal').style.display = 'none';
                document.getElementById('finalTestPassword').value = '';
                selectQuestionSet('FINAL');
                
                // Check if student has previous Final Exam attempt
                setTimeout(function() {
                    var existingScore = getStudentFinalScore(studentId);
                    if (existingScore) {
                        showNotification('üìã Previous Final Exam: ' + existingScore.percentage + '% (' + (existingScore.passed ? 'PASSED' : 'FAILED') + ') on ' + existingScore.date, 'info', 5000);
                    }
                }, 500);
                
                setTimeout(function() {
                    showNotification('‚úÖ Final Test Access Granted! Good luck with your comprehensive assessment!', 'success', 4000);
                }, 1000);
            } else {
                showNotification('‚ùå Incorrect Password! Contact your instructor for the correct password.', 'error');
                document.getElementById('finalTestPassword').value = '';
                document.getElementById('finalTestPassword').focus();
            }
        }
        
        function closeFinalTestModal() {
            document.getElementById('passwordModal').style.display = 'none';
            document.getElementById('finalTestPassword').value = '';
        }
        
        // Question set selection
        function selectQuestionSet(setId) {
            selectedQuestionSet = setId;
            questions = questionSets[setId].questions;
            
            hideAllSections();
            document.getElementById('studentInfoSection').style.display = 'block';
            document.getElementById('examHeader').style.display = 'block';
            
            var setInfo = questionSets[setId];
            document.getElementById('selectedSetDisplay').textContent = 'üìù Selected: ' + setInfo.title;
            
            var timeLimit = setId === 'FINAL' ? '60 minutes' : '35 minutes';
            var questionCount = setId === 'FINAL' ? '40' : '25';
            var passingScore = setId === 'FINAL' ? '70%' : '60%';
            var correctAnswers = setId === 'FINAL' ? '28' : '15';
            
            document.getElementById('instructionsList').innerHTML = 
                '<li>‚è∞ <strong>Time Limit:</strong> ' + timeLimit + '</li>' +
                '<li>üìä <strong>Questions:</strong> ' + questionCount + ' Multiple Choice Questions</li>' +
                '<li>üéØ <strong>Difficulty:</strong> ' + setInfo.title.split(' - ')[1] + '</li>' +
                '<li>‚úÖ <strong>Passing Score:</strong> ' + passingScore + ' (' + correctAnswers + ' correct answers)</li>' +
                '<li>‚è≠Ô∏è <strong>Skip Option:</strong> You can skip questions and return later</li>' +
                '<li>üîÑ <strong>Navigation:</strong> Use Previous/Next buttons to move between questions</li>' +
                '<li>üì§ <strong>Auto-Submit:</strong> Exam will auto-submit when time expires</li>' +
                '<li>üéØ <strong>Smart Features:</strong> Progress tracking, visual feedback, and performance analytics</li>' +
                (setId === 'FINAL' ? '<li>üèÜ <strong>Final Assessment:</strong> Comprehensive test with 25 mixed questions + 15 intermediate questions</li>' : '');
            
            document.getElementById('studentDetails').innerHTML = 
                '<p><strong>üéì Student Name:</strong> ' + currentStudentData.name + '</p>' +
                '<p><strong>üÜî Student Code:</strong> ' + studentId + '</p>' +
                '<p><strong>üìö Course:</strong> ' + currentStudentData.course + '</p>' +
                '<p><strong>üìÖ Join Date:</strong> ' + (currentStudentData.joinDate || 'N/A') + '</p>';
            
            showNotification('Question Set ' + setId + ' selected. ' + questionCount + ' questions, ' + timeLimit + ' time limit.', 'info');
        }
        
        // Start exam
        function startExam() {
            examStarted = true;
            
            hideAllSections();
            document.getElementById('examSection').style.display = 'block';
            document.getElementById('examHeader').style.display = 'block';
            
            userAnswers = new Array(questions.length).fill(null);
            currentQuestion = 0;
            timeLeft = questionSets[selectedQuestionSet].timeLimit;
            
            // Update progress display for current question count
            document.getElementById('progress').innerHTML = 
                '<span>üìä</span>' +
                '<span>Question 1 of ' + questions.length + '</span>';
            
            timer = setInterval(function() {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    autoSubmitExam();
                }
            }, 1000);
            
            loadQuestion();
            showNotification('Exam started! Good luck with ' + questions.length + ' questions!', 'success', 2000);
        }
        
        // Load question
        function loadQuestion() {
            var question = questions[currentQuestion];
            var container = document.getElementById('questionContainer');
            
            container.style.opacity = '0';
            
            setTimeout(function() {
                var questionHTML = 
                    '<div class="question">' +
                        '<strong>' + (currentQuestion + 1) + '. ' + question.question + '</strong>' +
                    '</div>' +
                    '<div class="options">';
                
                for (var i = 0; i < question.options.length; i++) {
                    var isSelected = userAnswers[currentQuestion] === i;
                    questionHTML += 
                        '<div class="option ' + (isSelected ? 'selected' : '') + '" onclick="selectOption(' + i + ')">' +
                            '<input type="radio" name="question_' + currentQuestion + '" value="' + i + '" ' + (isSelected ? 'checked' : '') + '>' +
                            '<span>' + String.fromCharCode(65 + i) + '. ' + question.options[i] + '</span>' +
                        '</div>';
                }
                
                var isSkipped = userAnswers[currentQuestion] === -1;
                questionHTML += 
                    '<div class="option skip-option ' + (isSkipped ? 'selected' : '') + '" onclick="skipQuestion()">' +
                        '<input type="radio" name="question_' + currentQuestion + '" value="-1" ' + (isSkipped ? 'checked' : '') + '>' +
                        '<span>‚è≠Ô∏è SKIP (Answer Later)</span>' +
                    '</div>' +
                '</div>';
                
                container.innerHTML = questionHTML;
                container.style.opacity = '1';
                
                updateProgress();
                updateNavigation();
            }, 200);
        }
        
        // Answer selection
        function selectOption(optionIndex) {
            userAnswers[currentQuestion] = optionIndex;
            loadQuestion();
        }
        
        function skipQuestion() {
            userAnswers[currentQuestion] = -1;
            loadQuestion();
            showNotification('Question skipped. You can return to it later.', 'warning', 2000);
        }
        
        // Update progress
        function updateProgress() {
            var answeredCount = userAnswers.filter(function(a) { return a !== null && a !== -1; }).length;
            var skippedCount = userAnswers.filter(function(a) { return a === -1; }).length;
            
            document.getElementById('progress').innerHTML = 
                '<span>üìä</span>' +
                '<span>Question ' + (currentQuestion + 1) + ' of ' + questions.length + '</span>' +
                '<span style="font-size: 0.9rem; opacity: 0.8;">(' + answeredCount + ' answered, ' + skippedCount + ' skipped)</span>';
        }
        
        // Update navigation
        function updateNavigation() {
            var prevBtn = document.getElementById('prevBtn');
            var nextBtn = document.getElementById('nextBtn');
            var submitBtn = document.getElementById('submitBtn');
            
            if (prevBtn) prevBtn.disabled = currentQuestion === 0;
            
            var isLastQuestion = currentQuestion === questions.length - 1;
            if (nextBtn) nextBtn.style.display = isLastQuestion ? 'none' : 'inline-flex';
            if (submitBtn) submitBtn.style.display = isLastQuestion ? 'block' : 'none';
        }
        
        // Update timer display
        function updateTimerDisplay() {
            var minutes = Math.floor(timeLeft / 60);
            var seconds = timeLeft % 60;
            var timeDisplay = minutes.toString().padStart(2, '0') + ':' + seconds.toString().padStart(2, '0');
            
            var timerElement = document.getElementById('timer');
            timerElement.innerHTML = '<span>‚è∞</span><span>' + timeDisplay + '</span>';
            
            if (timeLeft < 120) {
                timerElement.style.color = '#e53e3e';
            } else if (timeLeft < 300) {
                timerElement.style.color = '#d69e2e';
            }
            
            if (timeLeft === 300) {
                showNotification('‚ö†Ô∏è 5 minutes remaining!', 'warning', 3000);
            } else if (timeLeft === 60) {
                showNotification('üö® 1 minute remaining!', 'error', 3000);
            }
        }
        
        // Question map
        function showQuestionMap() {
            var modal = document.getElementById('questionMapModal');
            var grid = document.getElementById('questionMapGrid');
            
            var mapHTML = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(50px, 1fr)); gap: 0.5rem; margin: 1rem 0;">';
            
            for (var i = 0; i < questions.length; i++) {
                var statusColor = '#e2e8f0';
                var statusText = '‚ùî';
                
                if (userAnswers[i] === -1) {
                    statusColor = '#fed7d7';
                    statusText = '‚è≠Ô∏è';
                } else if (userAnswers[i] !== null) {
                    statusColor = '#c6f6d5';
                    statusText = '‚úÖ';
                }
                
                if (i === currentQuestion) {
                    statusColor = '#bee3f8';
                    statusText = 'üëÜ';
                }
                
                mapHTML += 
                    '<div onclick="goToQuestion(' + i + '); closeQuestionMap();" ' +
                         'style="background: ' + statusColor + '; border: 2px solid #ccc; border-radius: 8px; ' +
                                'padding: 0.5rem; text-align: center; cursor: pointer; font-weight: bold; ' +
                                'transition: all 0.3s ease;" ' +
                         'onmouseover="this.style.transform=\'scale(1.1)\'" ' +
                         'onmouseout="this.style.transform=\'scale(1)\'">' +
                        (i + 1) + '<br>' + statusText +
                    '</div>';
            }
            
            mapHTML += '</div>';
            mapHTML += '<div style="display: flex; justify-content: center; gap: 1rem; margin: 1rem 0; font-size: 0.9rem;">';
            mapHTML += '<span>‚úÖ Answered</span><span>‚è≠Ô∏è Skipped</span><span>‚ùî Unanswered</span><span>üëÜ Current</span>';
            mapHTML += '</div>';
            
            grid.innerHTML = mapHTML;
            modal.style.display = 'block';
        }
        
        function closeQuestionMap() {
            document.getElementById('questionMapModal').style.display = 'none';
        }
        
        function goToQuestion(questionIndex) {
            currentQuestion = questionIndex;
            loadQuestion();
        }
        
        // Navigation functions
        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                loadQuestion();
            }
        }
        
        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                loadQuestion();
            }
        }
        
        // Exam submission - CLEAN VERSION
        function submitExam() {
            var unansweredCount = userAnswers.filter(function(a) { return a === null; }).length;
            var skippedCount = userAnswers.filter(function(a) { return a === -1; }).length;
            var answeredCount = userAnswers.filter(function(a) { return a !== null && a !== -1; }).length;
            
            var modalMessage = '';
            
            // Show warning if there are unanswered or skipped questions
            if (unansweredCount > 0 || skippedCount > 0) {
                modalMessage = '<div style="background: #fed7d7; padding: 1.5rem; border-radius: 10px; margin: 1rem 0;">';
                
                if (unansweredCount > 0 && skippedCount > 0) {
                    modalMessage += '<p style="font-weight: bold; color: #c53030; margin-bottom: 1rem;">‚ö†Ô∏è You have incomplete answers!</p>';
                    modalMessage += '<p>You have <strong>' + unansweredCount + ' unanswered</strong> and <strong>' + skippedCount + ' skipped</strong> questions.</p>';
                } else if (unansweredCount > 0) {
                    modalMessage += '<p style="font-weight: bold; color: #c53030; margin-bottom: 1rem;">‚ö†Ô∏è You have unanswered questions!</p>';
                    modalMessage += '<p>You have <strong>' + unansweredCount + ' unanswered</strong> questions.</p>';
                } else if (skippedCount > 0) {
                    modalMessage += '<p style="font-weight: bold; color: #c53030; margin-bottom: 1rem;">‚ö†Ô∏è You have skipped questions!</p>';
                    modalMessage += '<p>You have <strong>' + skippedCount + ' skipped</strong> questions.</p>';
                }
                
                modalMessage += '<div style="background: white; padding: 1rem; border-radius: 8px; margin: 1rem 0;">';
                modalMessage += '<h4 style="margin-bottom: 0.5rem;">üìä Summary:</h4>';
                modalMessage += '<p>‚úÖ <strong>Answered:</strong> ' + answeredCount + '/' + questions.length + '</p>';
                if (skippedCount > 0) modalMessage += '<p>‚è≠Ô∏è <strong>Skipped:</strong> ' + skippedCount + '</p>';
                if (unansweredCount > 0) modalMessage += '<p>‚ùì <strong>Unanswered:</strong> ' + unansweredCount + '</p>';
                modalMessage += '</div>';
                
                modalMessage += '<p style="font-weight: bold; color: #9c2626;">‚ö†Ô∏è Skipped and unanswered questions will be marked as <strong>INCORRECT</strong>.</p>';
                modalMessage += '</div>';
                modalMessage += '<p>Are you sure you want to submit your exam now?</p>';
                
            } else {
                // All questions answered - show success confirmation
                modalMessage = '<div style="background: #c6f6d5; padding: 1.5rem; border-radius: 10px; margin: 1rem 0;">';
                modalMessage += '<p style="font-weight: bold; color: #22543d; margin-bottom: 1rem;">üéâ Excellent work!</p>';
                modalMessage += '<p>You have answered <strong>all ' + questions.length + ' questions</strong>.</p>';
                modalMessage += '<div style="background: white; padding: 1rem; border-radius: 8px; margin: 1rem 0;">';
                modalMessage += '<p>‚úÖ <strong>Completed:</strong> ' + answeredCount + '/' + questions.length + ' questions</p>';
                modalMessage += '</div>';
                modalMessage += '</div>';
                modalMessage += '<p>Are you ready to submit your exam?</p>';
            }
            
            document.getElementById('submitModalMessage').innerHTML = modalMessage;
            document.getElementById('submitModal').style.display = 'block';
        }
        
        // Confirm submission
        function confirmSubmission() {
            document.getElementById('submitModal').style.display = 'none';
            
            if (timer) clearInterval(timer);
            calculateResults();
        }
        
        // Cancel submission
        function cancelSubmission() {
            document.getElementById('submitModal').style.display = 'none';
            showNotification('‚ö†Ô∏è Submission cancelled. You can continue answering questions.', 'warning', 3000);
        }
        
        function autoSubmitExam() {
            showNotification('‚è∞ Time is up! The exam will be submitted automatically.', 'error', 4000);
            setTimeout(function() {
                calculateResults();
            }, 1000);
        }
        
        // Calculate results
        function calculateResults() {
            var correctAnswers = 0;
            var attemptedQuestions = 0;
            var skippedQuestions = 0;
            
            for (var i = 0; i < questions.length; i++) {
                if (userAnswers[i] === -1) {
                    skippedQuestions++;
                } else if (userAnswers[i] !== null) {
                    attemptedQuestions++;
                    if (userAnswers[i] === questions[i].correct) {
                        correctAnswers++;
                    }
                }
            }
            
            var totalQuestions = questions.length;
            var percentage = Math.round((correctAnswers / totalQuestions) * 100);
            var passingScore = questionSets[selectedQuestionSet].passingScore;
            var passed = percentage >= passingScore;
            
            // Save result
            var result = {
                studentName: currentStudentData.name,
                studentCode: studentId,
                course: currentStudentData.course,
                questionSet: selectedQuestionSet,
                score: correctAnswers,
                totalQuestions: totalQuestions,
                percentage: percentage,
                passed: passed,
                date: new Date().toLocaleDateString(),
                timeTaken: getTimeTaken()
            };
            // NEW: Also save to Google Sheets for Final Exam
        if (selectedQuestionSet === 'FINAL') {
            saveFinalExamToGoogleSheets(
                {
                    studentCode: studentId,
                    studentName: currentStudentData.name,
                    course: currentStudentData.course
                },
                correctAnswers,      // score
                totalQuestions,      // total questions
                percentage,          // percentage
                passed,              // passed status
                getTimeTaken()       // time taken
            );
        }
            examResults.push(result);
            
            // Save Final Exam scores permanently
            if (selectedQuestionSet === 'FINAL') {
                saveFinalExamScore({
                    studentCode: studentId,
                    studentName: currentStudentData.name,
                    course: currentStudentData.course
                }, correctAnswers, totalQuestions, percentage, passed, getTimeTaken());
            }
            
            // Show results
            hideAllSections();
            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('examHeader').style.display = 'block';
            
            updateProgressCircle(percentage);
            
            var scoreDisplay = document.getElementById('scoreDisplay');
            scoreDisplay.textContent = correctAnswers + '/' + totalQuestions + ' (' + percentage + '%)';
            scoreDisplay.className = 'score ' + (passed ? 'pass' : 'fail');
            
            updateAchievementBadges(percentage, passed, selectedQuestionSet);
            
            var testType = selectedQuestionSet === 'FINAL' ? 'Final Comprehensive Test' : 'Practice Test Set ' + selectedQuestionSet;
            document.getElementById('resultMessage').innerHTML = 
                '<div style="background: ' + (passed ? '#c6f6d5' : '#fed7d7') + '; padding: 1.5rem; border-radius: 15px; margin: 1rem 0;">' +
                    '<p><strong>üéì Student Name:</strong> ' + currentStudentData.name + '</p>' +
                    '<p><strong>üìö Course:</strong> ' + currentStudentData.course + '</p>' +
                    '<p><strong>üÜî Student Code:</strong> ' + studentId + '</p>' +
                    '<p><strong>üìù Test Type:</strong> ' + testType + '</p>' +
                    '<p><strong>üìä Status:</strong> ' + (passed ? '‚úÖ PASSED' : '‚ùå FAILED') + '</p>' +
                    '<p><strong>üéØ Required Score:</strong> ' + passingScore + '%</p>' +
                    '<p><strong>üèÜ Grade:</strong> ' + getGrade(percentage) + '</p>' +
                    '<p><strong>üìù Attempted:</strong> ' + attemptedQuestions + '/' + totalQuestions + ' questions</p>' +
                    '<p><strong>‚è≠Ô∏è Skipped:</strong> ' + skippedQuestions + ' questions</p>' +
                    '<p><strong>‚è±Ô∏è Time Taken:</strong> ' + getTimeTaken() + '</p>' +
                    '<p><strong>üìÖ Date:</strong> ' + new Date().toLocaleString() + '</p>' +
                '</div>';
            
            var certificateBtn = document.getElementById('certificateBtn');
            if (passed && selectedQuestionSet === 'FINAL') {
                certificateBtn.style.display = 'inline-block';
            } else {
                certificateBtn.style.display = 'none';
            }
            
            if (passed) {
                showNotification('üéâ Congratulations! You passed with ' + percentage + '%!', 'success', 5000);
            } else {
                showNotification('üìö Keep studying! You scored ' + percentage + '%. Required: ' + passingScore + '%', 'warning', 5000);
            }
        }
        
        // Helper functions
        function updateProgressCircle(percentage) {
            var circle = document.getElementById('progressCircle');
            var text = document.getElementById('progressText');
            
            var color = percentage >= 90 ? '#48bb78' : 
                       percentage >= 70 ? '#4299e1' : 
                       percentage >= 60 ? '#d69e2e' : '#e53e3e';
            
            circle.style.background = 'conic-gradient(' + color + ' ' + percentage + '%, #e2e8f0 ' + percentage + '%)';
            text.textContent = percentage + '%';
            text.style.color = color;
        }
        
        function updateAchievementBadges(percentage, passed, setId) {
            var badges = document.getElementById('achievementBadges');
            var badgeHTML = '';
            
            if (percentage >= 95) {
                badgeHTML += '<div class="badge excellent">üèÜ EXCELLENCE</div>';
            } else if (percentage >= 85) {
                badgeHTML += '<div class="badge excellent">‚≠ê OUTSTANDING</div>';
            } else if (percentage >= 75) {
                badgeHTML += '<div class="badge good">üëç GOOD JOB</div>';
            } else if (percentage >= 60) {
                badgeHTML += '<div class="badge average">‚úÖ PASSED</div>';
            } else {
                badgeHTML += '<div class="badge poor">üìö STUDY MORE</div>';
            }
            
            if (setId === 'FINAL' && passed) {
                badgeHTML += '<div class="badge excellent">üéì CERTIFIED</div>';
            }
            
            if (percentage === 100) {
                badgeHTML += '<div class="badge excellent">üíé PERFECT SCORE</div>';
            }
            
            badges.innerHTML = badgeHTML;
        }
        
        function getGrade(percentage) {
            if (percentage >= 95) return 'A+';
            if (percentage >= 90) return 'A';
            if (percentage >= 85) return 'A-';
            if (percentage >= 80) return 'B+';
            if (percentage >= 75) return 'B';
            if (percentage >= 70) return 'B-';
            if (percentage >= 65) return 'C+';
            if (percentage >= 60) return 'C';
            if (percentage >= 55) return 'C-';
            if (percentage >= 50) return 'D';
            return 'F';
        }
        
        function getTimeTaken() {
            var totalTime = questionSets[selectedQuestionSet].timeLimit;
            var timeTaken = totalTime - timeLeft;
            var minutes = Math.floor(timeTaken / 60);
            var seconds = timeTaken % 60;
            return minutes + ':' + seconds.toString().padStart(2, '0');
        }
        
        function generateCertificate() {
            showNotification('üéì Certificate generation feature - Download your achievement certificate!', 'success', 3000);
        }
        
        // Review section
        function showReview() {
            hideAllSections();
            document.getElementById('reviewSection').style.display = 'block';
            document.getElementById('examHeader').style.display = 'block';
            
            var reviewHTML = '';
            for (var i = 0; i < questions.length; i++) {
                var question = questions[i];
                var userAnswer = userAnswers[i];
                var correctAnswer = question.correct;
                var isCorrect = userAnswer === correctAnswer;
                var wasSkipped = userAnswer === -1;
                var wasNotAnswered = userAnswer === null;
                
                var statusIcon = wasNotAnswered ? '‚ùå' : wasSkipped ? '‚è≠Ô∏è' : isCorrect ? '‚úÖ' : '‚ùå';
                var statusColor = wasNotAnswered ? '#e53e3e' : wasSkipped ? '#d69e2e' : isCorrect ? '#38a169' : '#e53e3e';
                var statusText = wasNotAnswered ? 'Not Answered' : wasSkipped ? 'Skipped' : isCorrect ? 'Correct' : 'Incorrect';
                
                reviewHTML += 
                    '<div class="review-question">' +
                        '<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">' +
                            '<div class="question">' +
                                '<strong>' + (i + 1) + '. ' + question.question + '</strong>' +
                            '</div>' +
                            '<div style="color: ' + statusColor + '; font-weight: bold; font-size: 1.1rem;">' +
                                statusIcon + ' ' + statusText +
                            '</div>' +
                        '</div>' +
                        '<div class="options" style="margin-top: 1rem;">';
                
                for (var j = 0; j < question.options.length; j++) {
                    var className = 'option';
                    var optionIcon = '';
                    
                    if (j === correctAnswer) {
                        className += ' correct';
                        optionIcon = ' ‚úì';
                    }
                    if (j === userAnswer && !isCorrect && !wasSkipped && !wasNotAnswered) {
                        className += ' wrong';
                        optionIcon = ' ‚úó';
                    }
                    
                    reviewHTML += 
                        '<div class="' + className + '">' +
                            String.fromCharCode(65 + j) + '. ' + question.options[j] + optionIcon +
                        '</div>';
                }
                
                reviewHTML += '</div></div>';
            }
            
            document.getElementById('reviewContainer').innerHTML = reviewHTML;
        }
        
        function goBackToResult() {
            hideAllSections();
            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('examHeader').style.display = 'block';
        }
        
        // Restart exam - CLEAN VERSION
        function restartExam() {
            var confirmRestart = confirm('Are you sure you want to start a new exam? This will clear your current session.');
            
            if (confirmRestart) {
                try {
                    // Clear timer
                    if (timer) {
                        clearInterval(timer);
                        timer = null;
                    }
                    
                    // Reset all exam variables
                    examStarted = false;
                    currentQuestion = 0;
                    userAnswers = [];
                    timeLeft = 2100; // Reset to 35 minutes
                    selectedQuestionSet = 'A';
                    questions = [];
                    
                    // Hide all sections first
                    var sections = ['homeSection', 'setSelectionSection', 'studentInfoSection', 'examSection', 'resultSection', 'reviewSection', 'adminSection'];
                    sections.forEach(function(sectionId) {
                        var element = document.getElementById(sectionId);
                        if (element) {
                            element.style.display = 'none';
                        }
                    });
                    
                    // Show set selection with current student data
                    document.getElementById('examHeader').style.display = 'block';
                    document.getElementById('setSelectionSection').style.display = 'block';
                    
                    // Make sure student details are still shown
                    if (currentStudentData && studentId) {
                        document.getElementById('studentDetailsSet').innerHTML = 
                            '<p><strong>üéì Student Name:</strong> ' + currentStudentData.name + '</p>' +
                            '<p><strong>üÜî Student Code:</strong> ' + studentId + '</p>' +
                            '<p><strong>üìö Course:</strong> ' + currentStudentData.course + '</p>' +
                            '<p><strong>üìÖ Join Date:</strong> ' + (currentStudentData.joinDate || 'N/A') + '</p>';
                    }
                    
                    // Clear previous exam UI elements
                    document.getElementById('questionContainer').innerHTML = '';
                    
                    // Reset progress display
                    document.getElementById('progress').innerHTML = 
                        '<span>üìä</span>' +
                        '<span>Question 1 of 25</span>';
                    
                    // Reset timer display to match selected set
                    var defaultTime = selectedQuestionSet === 'FINAL' ? '60:00' : '35:00';
                    document.getElementById('timer').innerHTML = 
                        '<span>‚è∞</span>' +
                        '<span>' + defaultTime + '</span>';
                    
                    showNotification('‚úÖ Ready for new exam! Please select a question set.', 'success', 3000);
                    
                } catch (error) {
                    showNotification('‚ùå Error restarting exam. Please refresh the page.', 'error', 3000);
                }
            }
        }
        
        // Admin functions for Final Exam Records
        function showFinalExamRecords() {
            var records = getAllFinalExamScores();
            var container = document.getElementById('finalRecordsContainer');
            
            if (records.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 2rem; color: #718096;"><p>üìù No Final Exam records found.</p><p>Students need to complete the Final Test first.</p></div>';
            } else {
                var recordsHTML = '<div style="margin-bottom: 1rem; padding: 1rem; background: #e6fffa; border-radius: 8px;">';
                recordsHTML += '<h4 style="margin-bottom: 0.5rem; color: #234e52;">üìä Summary Statistics</h4>';
                recordsHTML += '<p><strong>Total Attempts:</strong> ' + records.length + '</p>';
                recordsHTML += '<p><strong>Passed:</strong> ' + records.filter(function(r) { return r.passed; }).length + '</p>';
                recordsHTML += '<p><strong>Failed:</strong> ' + records.filter(function(r) { return !r.passed; }).length + '</p>';
                recordsHTML += '<p><strong>Average Score:</strong> ' + Math.round(records.reduce(function(sum, r) { return sum + r.percentage; }, 0) / records.length) + '%</p>';
                recordsHTML += '</div>';
                
                recordsHTML += '<table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">';
                recordsHTML += '<thead><tr style="background: #4299e1; color: white;">';
                recordsHTML += '<th style="padding: 0.5rem; border: 1px solid #ddd;">Rank</th>';
                recordsHTML += '<th style="padding: 0.5rem; border: 1px solid #ddd;">Student Name</th>';
                recordsHTML += '<th style="padding: 0.5rem; border: 1px solid #ddd;">Student Code</th>';
                recordsHTML += '<th style="padding: 0.5rem; border: 1px solid #ddd;">Course</th>';
                recordsHTML += '<th style="padding: 0.5rem; border: 1px solid #ddd;">Score</th>';
                recordsHTML += '<th style="padding: 0.5rem; border: 1px solid #ddd;">Percentage</th>';
                recordsHTML += '<th style="padding: 0.5rem; border: 1px solid #ddd;">Status</th>';
                recordsHTML += '<th style="padding: 0.5rem; border: 1px solid #ddd;">Date</th>';
                recordsHTML += '</tr></thead><tbody>';
                
                records.forEach(function(record, index) {
                    var rowColor = record.passed ? '#f0fff4' : '#fff5f5';
                    var statusColor = record.passed ? '#38a169' : '#e53e3e';
                    var statusIcon = record.passed ? '‚úÖ' : '‚ùå';
                    
                    recordsHTML += '<tr style="background: ' + rowColor + ';">';
                    recordsHTML += '<td style="padding: 0.5rem; border: 1px solid #ddd; text-align: center; font-weight: bold;">' + (index + 1) + '</td>';
                    recordsHTML += '<td style="padding: 0.5rem; border: 1px solid #ddd;">' + record.studentName + '</td>';
                    recordsHTML += '<td style="padding: 0.5rem; border: 1px solid #ddd;">' + record.studentCode + '</td>';
                    recordsHTML += '<td style="padding: 0.5rem; border: 1px solid #ddd;">' + record.course + '</td>';
                    recordsHTML += '<td style="padding: 0.5rem; border: 1px solid #ddd; text-align: center;">' + record.score + '/' + record.totalQuestions + '</td>';
                    recordsHTML += '<td style="padding: 0.5rem; border: 1px solid #ddd; text-align: center; font-weight: bold;">' + record.percentage + '%</td>';
                    recordsHTML += '<td style="padding: 0.5rem; border: 1px solid #ddd; text-align: center; color: ' + statusColor + '; font-weight: bold;">' + statusIcon + ' ' + (record.passed ? 'PASSED' : 'FAILED') + '</td>';
                    recordsHTML += '<td style="padding: 0.5rem; border: 1px solid #ddd; text-align: center;">' + record.date + '</td>';
                    recordsHTML += '</tr>';
                });
                
                recordsHTML += '</tbody></table>';
                container.innerHTML = recordsHTML;
            }
            
            document.getElementById('finalRecordsModal').style.display = 'block';
        }
        
        function closeFinalRecordsModal() {
            document.getElementById('finalRecordsModal').style.display = 'none';
        }
        
        function exportFinalExamScores() {
            var records = getAllFinalExamScores();
            if (records.length === 0) {
                showNotification('‚ùå No Final Exam records to export', 'warning', 3000);
                return;
            }
            
            var csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Rank,Student Name,Student Code,Course,Score,Total Questions,Percentage,Status,Date,Time Taken\n";
            
            records.forEach(function(record, index) {
                csvContent += (index + 1) + ',';
                csvContent += '"' + record.studentName + '",';
                csvContent += record.studentCode + ',';
                csvContent += record.course + ',';
                csvContent += record.score + ',';
                csvContent += record.totalQuestions + ',';
                csvContent += record.percentage + '%,';
                csvContent += (record.passed ? 'PASSED' : 'FAILED') + ',';
                csvContent += record.date + ',';
                csvContent += record.timeTaken + '\n';
            });
            
            var encodedUri = encodeURI(csvContent);
            var link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "JYCC_Final_Exam_Scores_" + new Date().toISOString().split('T')[0] + ".csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('üì§ Final Exam scores exported successfully!', 'success', 3000);
        }
        
        function clearFinalExamRecords() {
            if (confirm('‚ö†Ô∏è Are you sure you want to delete ALL Final Exam records?\n\nThis action cannot be undone!')) {
                if (confirm('üö® FINAL WARNING: This will permanently delete all Final Exam scores and records.\n\nType "DELETE" in the next prompt to confirm.')) {
                    var confirmation = prompt('Type "DELETE" to confirm deletion of all Final Exam records:');
                    if (confirmation === 'DELETE') {
                        localStorage.removeItem('finalExamScores');
                        finalExamScores = [];
                        showNotification('üóëÔ∏è All Final Exam records have been deleted', 'error', 4000);
                        closeFinalRecordsModal();
                    } else {
                        showNotification('‚ùå Deletion cancelled - incorrect confirmation', 'warning', 3000);
                    }
                }
            }
        }
        document.getElementById('studentCode').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') accessTest();
        });
        
        document.getElementById('finalTestPassword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') verifyFinalTestPassword();
        });
        
        // Modal click outside to close
        window.onclick = function(event) {
            var passwordModal = document.getElementById('passwordModal');
            var questionMapModal = document.getElementById('questionMapModal');
            
            if (event.target === passwordModal) {
                closeFinalTestModal();
            }
            if (event.target === questionMapModal) {
                closeQuestionMap();
            }
        };
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                showNotification('Welcome to Advanced Excel MCQ System! üéì Now with 25 questions per set!', 'info', 4000);
            }, 1000);
        });
        
        // Prevent cheating during exam
        document.addEventListener('contextmenu', function(e) {
            if (examStarted) {
                e.preventDefault();
                showNotification('Right-click disabled during exam', 'warning', 2000);
            }
        });
        document.addEventListener('keydown', function(e) {
            if (examStarted) {
                if (e.key === 'F12' || 
                    (e.ctrlKey && e.shiftKey && e.key === 'I') ||
                    (e.ctrlKey && e.key === 'u')) {
                    e.preventDefault();
                    showNotification('Developer tools disabled during exam', 'warning', 2000);
                }
            }
        });
        // YOUR GOOGLE APPS SCRIPT URL
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxWCcEo3mVgXvKEskYuV6ZRJfpmr0BgPS0SBe_-ZzRUIbinUiG3V7Ur2-hCUSvLjx3I/exec';

// Function to save Final Exam results to Google Sheets
function saveFinalExamToGoogleSheets(studentData, score, totalQuestions, percentage, passed, timeTaken) {
    const examData = {
        studentCode: studentData.studentCode || studentId,
        studentName: studentData.studentName || currentStudentData.name,
        course: studentData.course || currentStudentData.course,
        score: score,
        totalQuestions: totalQuestions,
        percentage: percentage,
        passed: passed,
        timeTaken: timeTaken
    };

    showNotification('üíæ Saving results to Google Sheets...', 'info', 2000);

    fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(examData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification('‚úÖ Results saved to Google Sheets successfully!', 'success', 4000);
        } else {
            showNotification('‚ö†Ô∏è Warning: Results not saved to cloud. Saved locally only.', 'warning', 4000);
        }
    })
    .catch(error => {
        console.error('Error saving to Google Sheets:', error);
        showNotification('‚ö†Ô∏è Warning: Results not saved to cloud. Saved locally only.', 'warning', 4000);
    });
}
   </script>
</body>
</html>
